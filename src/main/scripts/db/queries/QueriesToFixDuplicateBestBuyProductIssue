select RETAILER_ID, PRODUCT_NAME, count(*) from PRODUCT group by RETAILER_ID, PRODUCT_NAME having count(*) > 1;

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;


select PRODUCT_NAME, b.* from PRODUCT a, PRODUCT_PRICE_HISTORY b where a.PRODUCT_ID = b.PRODUCT_ID LIMIT 100;


Zyxel - N4100 Wireless Router - IEEE 802.11n (draft)

http://www.bestbuy.com/site/Zyxel+-+N4100+Wireless+Router+-+IEEE+802.11n+(draft)/4331732.p;jsessionid=7C2CCDF5E165B7397871CB04AC27F259.bbolsp-app06-20?id=1218475490012&skuId=4331732
http://www.bestbuy.com/site/Zyxel+-+N4100+Wireless+Router+-+IEEE+802.11n+(draft)/4331732.p;jsessionid=10F4A6EF86330EF5024FA9687871EA2B.bbolsp-app04-11?id=1218475490012&skuId=4331732

SELECT COUNT(*) FROM PRODUCT WHERE CATEGORY_ID = 3201;

select * from CATEGORY WHERE RETAILER_ID = 'BESTBUY' AND PARENT = 'N' LIMIT 10;

SELECT PRODUCT_NAME FROM PRODUCT WHERE CATEGORY_ID >= 3187 AND CATEGORY_ID<=3195;
->3371
SELECT DISTINCT(PRODUCT_NAME) FROM PRODUCT WHERE CATEGORY_ID >= 3187 AND CATEGORY_ID<=3195;
->436

SELECT DISTINCT(CONCAT( SUBSTRING_INDEX(URL, "jsessionid", 1), SUBSTR(URL, INSTR(url, "?id=")) )), PRODUCT_ID, URL FROM PRODUCT WHERE CATEGORY_ID = 3187 AND PRODUCT_NAME = 'Gear4 - Red Bird Speaker for Most Music Players, Mobile Phones and Tablets - Red';

SELECT PRODUCT_NAME, PRODUCT_ID, URL FROM PRODUCT WHERE CATEGORY_ID = 2535 AND PRODUCT_NAME = 'AZEND GROUP CORP - HR-701 7&quot; LCD TV';

SELECT A.PRODUCT_ID, MIN(A.PRODUCT_ID), PRODUCT_NAME, B.PRICE, B.TIME_MODIFIED FROM PRODUCT A, PRODUCT_PRICE_HISTORY B WHERE A.CATEGORY_ID = 3187 AND A.PRODUCT_NAME = 'Gear4 - Red Bird Speaker for Most Music Players, Mobile Phones and Tablets - Red' AND A.PRODUCT_ID = B.PRODUCT_ID ORDER BY B.TIME_MODIFIED;

 SELECT MIN(PRODUCT_ID) FROM PRODUCT WHERE PRODUCT_NAME = "SPIRIT";
 SELECT COUNT(*) FROM TEMP_UNIQ_PRODUCTS;
 
 SELECT * FROM TEMP_UNIQ_PRODUCTS WHERE COUNT < 100 AND COUNT > 10 LIMIT 10;
 
 SELECT A.PRODUCT_NAME, MIN(B.PRODUCT_ID) AS NEW_ID FROM TEMP_UNIQ_PRODUCTS A, PRODUCT B WHERE A.CATEGORY_ID = B.CATEGORY_ID AND A.PRODUCT_NAME = "SPIRIT" AND B.PRODUCT_NAME = A.PRODUCT_NAME;
 
 UPDATE TEMP_UNIQ_PRODUCTS A SET NEW_PRODUCT_ID = 
 (
 SELECT MIN(B.PRODUCT_ID) FROM PRODUCT B 
 WHERE B.CATEGORY_ID = 2535 
 AND B.PRODUCT_NAME ="AZEND GROUP CORP - HR-701 7&quot; LCD TV"
 )
 WHERE A.CATEGORY_ID = 2535
 AND A.PRODUCT_NAME ="AZEND GROUP CORP - HR-701 7&quot; LCD TV";

 SELECT A.CATEGORY_ID, A.PRODUCT_NAME, A.NEW_PRODUCT_ID, B.PRODUCT_ID, C.PRICE, C.TIME_MODIFIED, B.URL
 FROM
 TEMP_UNIQ_PRODUCTS A, PRODUCT B, PRODUCT_PRICE_HISTORY C
 WHERE
 A.CATEGORY_ID = 2535 AND A.PRODUCT_NAME ="AZEND GROUP CORP - HR-701 7&quot; LCD TV" AND
 B.CATEGORY_ID = A.CATEGORY_ID AND
 B.PRODUCT_NAME = A.PRODUCT_NAME AND
 C.PRODUCT_ID = B.PRODUCT_ID
 ORDER BY C.TIME_MODIFIED;
 
 
 UPDATE TEMP_UNIQ_PRODUCTS A, PRODUCT B 
 SET NEW_PRODUCT_ID = MIN(B.PRODUCT_ID) 
 WHERE A.CATEGORY_ID = 2535 
 AND A.PRODUCT_NAME IN ("Ciil - UltraView 32&quot; Class / LCD / 720p / 60Hz / HDTV")
 AND B.CATEGORY_ID = A.CATEGORY_ID
 AND B.PRODUCT_NAME = A.PRODUCT_NAME;
 
 bestbuy     |        2535 | AZEND GROUP CORP - HR-701 7&quot; LCD TV                                   |    14 |           NULL
 
 
  SHOW PROCESSELIST;
SHOW TABLE STATUS LIKE 'TEMP_UNIQ_PRODUCTS';
SHOW ENGINES;
 
 --POPULATE TEMP_UNIQ_PRODUCTS
 
 INSERT INTO TEMP_UNIQ_PRODUCTS 
 SELECT RETAILER_ID, CATEGORY_ID, PRODUCT_NAME, COUNT(*) AS COUNT, NULL
 FROM PRODUCT
 GROUP BY RETAILER_ID, CATEGORY_ID, PRODUCT_NAME
    
 COUNT          
 NEW_PRODUCT_ID 

UPDATE TEMP_UNIQ_PRODUCTS A SET NEW_PRODUCT_ID = 
 (
 SELECT MIN(B.PRODUCT_ID) FROM PRODUCT B USE INDEX (PRODUCT_NAME_idx)
 WHERE B.CATEGORY_ID = A.CATEGORY_ID 
 AND B.PRODUCT_NAME = A.PRODUCT_NAME
 )
 
 --sanity check that new_product_id is correct
 SELECT A.COUNT, A.NEW_PRODUCT_ID, B.PRODUCT_ID AS OLD_PRODUCT_ID, B.RETAILER_ID, B.CATEGORY_ID, B.PRODUCT_NAME
 FROM 
  TEMP_UNIQ_PRODUCTS A, PRODUCT B
 WHERE
  B.CATEGORY_ID = A.CATEGORY_ID 
  AND B.PRODUCT_NAME = A.PRODUCT_NAME
  AND A.CATEGORY_ID = 3000
 ORDER BY B.RETAILER_ID, B.CATEGORY_ID, B.PRODUCT_NAME, B.PRODUCT_ID
 LIMIT 100;
 
 --insert old->new map in temp table
 INSERT INTO TEMP_PRODUCT_ID_MAP
 SELECT B.PRODUCT_ID AS OLD_PRODUCT_ID, A.NEW_PRODUCT_ID 
 FROM 
  TEMP_UNIQ_PRODUCTS A, PRODUCT B
 WHERE
  B.CATEGORY_ID = A.CATEGORY_ID 
  AND B.PRODUCT_NAME = A.PRODUCT_NAME  

--SANITY CHECK OF MAP TABLE
SELECT A.COUNT, A.NEW_PRODUCT_ID, B.PRODUCT_ID AS OLD_PRODUCT_ID, B.RETAILER_ID, B.CATEGORY_ID, B.PRODUCT_NAME
 FROM 
  TEMP_UNIQ_PRODUCTS A, PRODUCT B
 WHERE
  B.CATEGORY_ID = A.CATEGORY_ID 
  AND B.PRODUCT_NAME = A.PRODUCT_NAME
  AND A.NEW_PRODUCT_ID = 681465
 ORDER BY B.RETAILER_ID, B.CATEGORY_ID, B.PRODUCT_NAME, B.PRODUCT_ID;
 
 
 --FIX PRODUCT_PRICE_HISTORY
 UPDATE PRODUCT_PRICE_HISTORY A, TEMP_PRODUCT_ID_MAP B
 SET A.PRODUCT_ID = B.NEW_PRODUCT_ID
 WHERE 
 B.OLD_PRODUCT_ID = A.PRODUCT_ID
--AND A.PRODUCT_ID = 11213572;
 
 --FIX PRODUCT TABLE
 DELETE FROM PRODUCT WHERE PRODUCT_ID NOT IN (SELECT NEW_PRODUCT_ID FROM TEMP_PRODUCT_ID_MAP)
 
SELECT * FROM PRODUCT_PRICE_HISTORY WHERE PRODUCT_ID = 4847;
SELECT * FROM PRODUCT_PRICE_HISTORY WHERE PRODUCT_ID = 3165;
SELECT * FROM PRODUCT_PRICE_HISTORY WHERE PRODUCT_ID = 681465;
SELECT * FROM PRODUCT_PRICE_HISTORY WHERE PRODUCT_ID = 4847;


 SELECT B.NEW_PRODUCT_ID, A.TIME, COUNT(*)
 FROM
  PRODUCT_PRICE_HISTORY A, TEMP_PRODUCT_ID_MAP B
 WHERE 
 B.OLD_PRODUCT_ID = A.PRODUCT_ID
 AND A.PRODUCT_ID IN (126, 16)
 GROUP BY B.NEW_PRODUCT_ID, A.TIME
 HAVING COUNT(*) > 1
 
 SELECT B.NEW_PRODUCT_ID, A.*
 FROM
  PRODUCT_PRICE_HISTORY A, TEMP_PRODUCT_ID_MAP B
 WHERE 
 B.OLD_PRODUCT_ID = A.PRODUCT_ID
 AND B.NEW_PRODUCT_ID IN (5850674);
 
 
DELETE FROM PRODUCT WHERE PRODUCT_ID<2000000 AND PRODUCT_ID NOT IN (SELECT NEW_PRODUCT_ID FROM TEMP_PRODUCT_ID_MAP);
DELETE FROM PRODUCT WHERE PRODUCT_ID>=2000000 AND PRODUCT_ID<3000000 AND PRODUCT_ID NOT IN (SELECT NEW_PRODUCT_ID FROM TEMP_PRODUCT_ID_MAP);
DELETE FROM PRODUCT WHERE PRODUCT_ID>=3000000 AND PRODUCT_ID<4000000 AND PRODUCT_ID NOT IN (SELECT NEW_PRODUCT_ID FROM TEMP_PRODUCT_ID_MAP);
DELETE FROM PRODUCT WHERE PRODUCT_ID>=4000000 AND PRODUCT_ID<5000000 AND PRODUCT_ID NOT IN (SELECT NEW_PRODUCT_ID FROM TEMP_PRODUCT_ID_MAP);
DELETE FROM PRODUCT WHERE PRODUCT_ID>=5000000 AND PRODUCT_ID<6000000 AND PRODUCT_ID NOT IN (SELECT NEW_PRODUCT_ID FROM TEMP_PRODUCT_ID_MAP);
